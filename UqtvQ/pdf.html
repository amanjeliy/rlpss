<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Військово-обліковий документ</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <style>
    :root {
      --ios-blue: #007AFF;
      --bg-gray: #F2F2F7;
      --header-bg: rgba(255, 255, 255, 0.85);
    }

    body, html {
      margin: 0; padding: 0; width: 100%; height: 100%;
      background-color: var(--bg-gray);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      overflow: hidden; /* Prevents whole-page bouncing */
      -webkit-user-select: none;
      user-select: none;
    }

    /* iOS Header Style */
    .header {
      position: fixed; top: 0; width: 100%;
      height: calc(60px + env(safe-area-inset-top));
      padding-top: env(safe-area-inset-top);
      display: flex; align-items: center; justify-content: space-between;
      padding-left: 16px; padding-right: 16px; box-sizing: border-box;
      background: var(--header-bg);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      z-index: 100; border-bottom: 0.5px solid #d1d1d6;
    }

    .header-title {
      font-size: 17px; font-weight: 600; color: #000;
      display: flex; align-items: center; gap: 4px;
    }

    .done-btn {
      color: var(--ios-blue); font-size: 17px; font-weight: 600;
      background: none; border: none; padding: 8px; cursor: pointer;
    }

    /* PDF Container Logic */
    #viewport {
      width: 100%; height: 100%;
      overflow: auto;
      padding: calc(75px + env(safe-area-inset-top)) 10px 100px 10px;
      box-sizing: border-box;
      display: flex; justify-content: center; align-items: flex-start;
      -webkit-overflow-scrolling: touch;
      touch-action: none; /* Crucial for custom gesture handling */
    }

    #canvas-container {
      background: white;
      box-shadow: 0 5px 25px rgba(0,0,0,0.12);
      border-radius: 6px;
      transform-origin: top center;
      transition: transform 0.2s cubic-bezier(0.25, 1, 0.5, 1);
    }

    canvas {
      display: block; border-radius: 6px;
    }

    /* Bottom Toolbar */
    .toolbar {
      position: fixed; bottom: 0; width: 100%;
      height: calc(70px + env(safe-area-inset-bottom));
      padding-bottom: env(safe-area-inset-bottom);
      background: var(--header-bg);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      display: flex; justify-content: space-between; align-items: center;
      padding-left: 45px; padding-right: 45px; box-sizing: border-box;
      border-top: 0.5px solid #d1d1d6;
      z-index: 100;
    }

    .icon-btn {
      background: none; border: none; padding: 10px;
      color: var(--ios-blue); cursor: pointer;
    }

    .icon { width: 26px; height: 26px; fill: none; stroke: currentColor; stroke-width: 1.5; }
  </style>
</head>
<body>

<div class="header">
  <div style="width: 60px;"></div>
  <div class="header-title">
    Військово-обліковий документ
    <svg width="10" height="10" viewBox="0 0 10 10" fill="#8E8E93"><path d="M1 3l4 4 4-4"/></svg>
  </div>
  <button class="done-btn" onclick="resetZoom()">Done</button>
</div>

<div id="viewport">
  <div id="canvas-container">
    <canvas id="pdf-canvas"></canvas>
  </div>
</div>

<div class="toolbar">
  <button class="icon-btn">
    <svg class="icon" viewBox="0 0 24 24"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8m-16-4l8-8 8 8m-8-8v13"/></svg>
  </button>
  <button class="icon-btn">
    <svg class="icon" viewBox="0 0 24 24" style="stroke-width: 2;"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
  </button>
</div>

<script>
  const url = 'https://amanjeliy.github.io/rlpss/UqtvQ/vod.pdf'; // Path to your file
  let pdfDoc = null, scale = 1.0, initialScale = 1.0, lastTap = 0;
  const canvas = document.getElementById('pdf-canvas');
  const container = document.getElementById('canvas-container');
  const ctx = canvas.getContext('2d');

  const pdfjsLib = window['pdfjs-dist/build/pdf'];
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

  // Initialize and Auto-Fit
  pdfjsLib.getDocument(url).promise.then(pdf => {
    pdfDoc = pdf;
    pdf.getPage(1).then(page => {
      const unscaledViewport = page.getViewport({ scale: 1 });
      const screenWidth = window.innerWidth - 32; // Responsive padding

      // Calculate scale to fit iPhone screen width perfectly
      scale = screenWidth / unscaledViewport.width;
      initialScale = scale;

      renderPage();
    });
  });

  function renderPage() {
    pdfDoc.getPage(1).then(page => {
      const dpr = window.devicePixelRatio || 1;
      const viewport = page.getViewport({ scale: scale });

      canvas.width = viewport.width * dpr;
      canvas.height = viewport.height * dpr;
      canvas.style.width = viewport.width + "px";
      canvas.style.height = viewport.height + "px";

      const renderContext = {
        canvasContext: ctx,
        viewport: viewport,
        transform: [dpr, 0, 0, dpr, 0, 0]
      };
      page.render(renderContext);
    });
  }

  // --- GESTURE HANDLING ---
  const view = document.getElementById('viewport');

  // Pinch Zoom (iOS Safari exclusive gesture events)
  view.addEventListener('gesturestart', (e) => {
    e.preventDefault();
    container.style.transition = 'none';
  });

  view.addEventListener('gesturechange', (e) => {
    e.preventDefault();
    container.style.transform = `scale(${e.scale})`;
  });

  view.addEventListener('gestureend', (e) => {
    e.preventDefault();
    scale = Math.min(Math.max(scale * e.scale, initialScale * 0.8), initialScale * 4);
    container.style.transform = 'scale(1)';
    container.style.transition = 'transform 0.2s cubic-bezier(0.25, 1, 0.5, 1)';
    renderPage();
  });

  // Double Tap Reset
  view.addEventListener('touchend', (e) => {
    const now = new Date().getTime();
    const timesince = now - lastTap;
    if (timesince < 300 && timesince > 0) {
      e.preventDefault();
      resetZoom();
    }
    lastTap = now;
  });

  function resetZoom() {
    scale = initialScale;
    container.style.transform = 'scale(1)';
    renderPage();
  }
</script>
</body>
</html>