<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BankApp">

    <title>Face ID Unlock</title>

    <style>
        /* --- 1. Variables & Base --- */
        :root {
            --ios-green: #2ed158;
            --island-bg: #000000;
            --app-bg: #121212;
            --card-bg: #1c1c1e;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--app-bg);
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            color: white;
        }

        /* --- 2. Main App Content --- */
        .main-app-content {
            padding-top: calc(60px + env(safe-area-inset-top));
            padding-left: 20px;
            padding-right: 20px;
            height: 100%;
            box-sizing: border-box;
            background: var(--card-bg);

            /* UNLOCKED STATE: Smooth transition back to clear */
            transition: filter 0.5s ease, transform 0.5s ease;
            transform-origin: center center;
            filter: blur(0px);
            transform: scale(1);
        }

        /* LOCKED STATE: INSTANT blur */
        body.locked .main-app-content {
            filter: blur(20px) brightness(0.7); /* Increased blur */
            transform: scale(0.96);
            pointer-events: none;

            /* IMMEDIATE transition to beat the iOS snapshot */
            transition: none !important;
        }

        /* --- 3. Dynamic Island Overlay --- */
        #island-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            z-index: 9999;
            padding-top: 11px;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        /* The Black Pill (Island) */
        .dynamic-island {
            background-color: var(--island-bg);
            border-radius: 30px;
            width: 0px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);

            /* Smooth size expansion */
            transition: width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1),
            height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1),
            border-radius 0.4s ease;
        }

        /* Active State (Expanded) */
        body.locked .dynamic-island {
            width: 160px;
            height: 160px;
            border-radius: 44px;
            pointer-events: auto;
            /* Instant transition on lock */
            transition: none !important;
        }

        /* Unlocking State (Restore animations) */
        body.unlocking .dynamic-island {
            transition: width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1),
            height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1),
            border-radius 0.4s ease;
        }

        /* --- 4. Icon Content --- */
        .island-content {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.2s ease, transform 0.3s ease;
        }

        body.locked .island-content {
            opacity: 1;
            transform: scale(1);
            transition: none !important;
        }

        body.unlocking .island-content {
            transition: opacity 0.2s ease, transform 0.3s ease;
        }

        /* --- 5. SVGs --- */
        .icon-container {
            width: 64px;
            height: 64px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* FACE ID SMILEY */
        #face-id-svg {
            stroke: var(--ios-green);
            fill: none;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
            opacity: 0;
            display: none;
        }

        body.locked #face-id-svg.scanning {
            display: block;
            opacity: 1;
            animation: faceScan 2s infinite linear;
        }

        @keyframes faceScan {
            0% { transform: perspective(400px) rotateY(0deg); }
            25% { transform: perspective(400px) rotateY(30deg); }
            50% { transform: perspective(400px) rotateY(0deg); }
            75% { transform: perspective(400px) rotateY(-30deg); }
            100% { transform: perspective(400px) rotateY(0deg); }
        }

        /* CHECKMARK */
        #success-svg {
            stroke: var(--ios-green);
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        #success-svg.visible {
            opacity: 1;
            transform: scale(1);
        }

        .hidden { display: none !important; }

    </style>
</head>
<body class="locked">

<div class="main-app-content">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div style="background: #333; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #aaa;">AM</div>
        <div style="color: white; font-weight: bold;">Earn Â£50</div>
    </div>
    <div style="margin-bottom: 10px; color: #888; font-size: 14px;">Total balance</div>
    <div style="font-size: 32px; font-weight: 700; margin-bottom: 20px; color: white;">
        779,558.01 <span style="font-size: 16px; color: #888;">UAH</span>
    </div>
    <div style="display: flex; gap: 10px; margin-bottom: 30px;">
        <button style="flex: 1; background: var(--ios-green); color: black; border: none; padding: 14px; border-radius: 20px; font-weight: 600; font-size: 16px;">Send</button>
        <button style="flex: 1; background: #333; color: var(--ios-green); border: none; padding: 14px; border-radius: 20px; font-weight: 600; font-size: 16px;">Add money</button>
        <button style="flex: 1; background: #333; color: var(--ios-green); border: none; padding: 14px; border-radius: 20px; font-weight: 600; font-size: 16px;">Request</button>
    </div>
    <div style="background: #2c2c2e; border-radius: 16px; padding: 15px; display: flex; align-items: center; margin-bottom: 10px;">
        <div style="background: #000; width: 40px; height: 40px; border-radius: 50%; margin-right: 15px;"></div>
        <div>
            <div style="font-weight: 600;">USD Account</div>
            <div style="color: #888; font-size: 13px;">$ 16,602.91</div>
        </div>
    </div>
    <p style="text-align: center; color: #555; margin-top: 50px; font-size: 14px;">Switch apps to test Face ID</p>
</div>

<div id="island-overlay">
    <div class="dynamic-island">
        <div class="island-content">
            <div class="icon-container">
                <svg id="face-id-svg" class="scanning" viewBox="0 0 50 50">
                    <path d="M14,4 A14,14 0 0,0 4,14" />
                    <path d="M36,4 A14,14 0 0,1 46,14" />
                    <path d="M46,36 A14,14 0 0,1 36,46" />
                    <path d="M4,36 A14,14 0 0,0 14,46" />
                    <path d="M17,20 L17,20" stroke-width="4" />
                    <path d="M33,20 L33,20" stroke-width="4" />
                    <path d="M17,30 Q25,38 33,30" />
                </svg>
                <svg id="success-svg" viewBox="0 0 50 50">
                    <circle cx="25" cy="25" r="23" stroke-width="2.5" />
                    <path d="M14 26 L22 34 L36 16" stroke-width="3" />
                </svg>
            </div>
        </div>
    </div>
</div>

<script>
  const faceSvg = document.getElementById('face-id-svg');
  const successSvg = document.getElementById('success-svg');
  let isLocked = false;

  // 1. LOCK FUNCTION (Optimized for Speed)
  const lockApp = () => {
    if(isLocked) return;
    isLocked = true;

    document.body.classList.remove('unlocking');
    document.body.classList.add('locked');

    // FORCE REPAINT (Critical Fix)
    // accessing offsetWidth forces the browser to apply the 'locked' class
    // and calculate styles immediately, before the OS takes the screenshot.
    void document.body.offsetWidth;

    // Reset UI
    faceSvg.classList.add('scanning');
    faceSvg.style.display = 'block';
    successSvg.classList.remove('visible');
  };

  // 2. UNLOCK FUNCTION
  const unlockSequence = () => {
    document.body.classList.add('unlocking');

    setTimeout(() => {
      setTimeout(() => {
        faceSvg.style.display = 'none';
        successSvg.classList.add('visible');
        setTimeout(() => {
          document.body.classList.remove('locked');
          isLocked = false;
        }, 700);
      }, 1200);
    }, 200);
  };

  // --- LISTENERS ---

  // FIX: 'blur' fires before 'pagehide' on many iOS versions when entering multitasking
  window.addEventListener("blur", lockApp);

  // Backup: Standard page closing/hiding event
  window.addEventListener("pagehide", lockApp);

  // Handle returning to the app
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
      lockApp();
    } else {
      // If returning and locked, unlock
      if (isLocked) {
        unlockSequence();
      }
    }
  });

  // Also unlock on focus if needed (e.g. coming from Notification Center)
  window.addEventListener("focus", () => {
    if (!document.hidden && isLocked) {
      unlockSequence();
    }
  });

  // Initial Load
  window.addEventListener("load", () => {
    lockApp();
    unlockSequence();
  });
</script>
</body>
</html>